!function(){Traction={Rendering:{},Bindings:{},TemplateHelpers:{},Rails:{},Forms:{}}}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Traction.Model=function(b){function d(){Backbone.Model.apply(this,arguments),this.computedAttributes||(this.computedAttributes={}),this._assignComputedAttributes()}return c(d,b),d.prototype._assignComputedAttributes=function(){var b,c,d,e;d=this.computedAttributes,e=[];for(b in d)c=d[b],e.push(new a(b,c).bindTo(this));return e},d}(Backbone.Model),a=function(){function a(a,b){this.attribute=a,this.computation=b}return a.prototype.bindTo=function(a){var b,c,d,e;for(this.model=a,e=this._dependencies(),c=0,d=e.length;d>c;c++)b=e[c],this.model.on("change:"+b,this._assign,this);return this._assign()},a.prototype._dependencies=function(){return _.map(this._getterCalls(),function(a){return a.replace(/this\.get\("/,"").replace(/\W/g,"")})},a.prototype._getterCalls=function(){return this.computation.toString().match(/this\.get\(.*?\)/g)},a.prototype._assign=function(){return this.model.set(this.attribute,this.computation.apply(this.model))},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.View=function(a){function c(){this.children=new Traction.ViewCollection,c.__super__.constructor.apply(this,arguments),this.renderer=this.buildRenderer()}return b(c,a),c.prototype.buildRenderer=function(){return this.template?new Traction.Rendering.TemplateStrategy({source:this.template,renderWithin:this.el}):this.options.el?new Traction.Rendering.PrerenderedStrategy({renderWithin:this.el}):new Traction.Rendering.AppendStrategy({renderWithin:this.el})},c.prototype.proxyEvent=function(a,b,c){var d,e=this;return d=function(){var a;return a=Array.prototype.slice.call(arguments),a.unshift(c||b),e.trigger.apply(e,a)},this.listenTo(a,b,d)},c.prototype.render=function(){return this.renderer.render({binding:this.binding}),this.renderer.outlet(this.children.render()),this},c.prototype.remove=function(){var a;return c.__super__.remove.apply(this,arguments),"function"==typeof(a=this.renderer).destroy&&a.destroy(),this.children.each(function(a){return a.remove()})},c}(Backbone.View),Traction.View.extend=function(a){return _.extend(this.prototype,a.prototype)}}.call(this),function(){Traction.ViewCollection=function(){function a(){this.collection={}}return a.prototype.add=function(a,b){return b?this.collection[a]=b:this.collection[_.uniqueId()]=a},a.prototype.get=function(a){return this.collection[a]},a.prototype.each=function(a){var b,c,d,e;d=this.collection,e=[];for(c in d)b=d[c],e.push(a(b));return e},a.prototype.map=function(a){return _.map(this.collection,function(b){return a(b)})},a.prototype.render=function(){return this.each(function(a){return a.render().delegateEvents()}),this},a.prototype.els=function(){return this.map(function(a){return a.el})},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rendering.NodeStrategy=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.bindings=[]}return b(c,a),c.prototype.events={"click :not(form)[data-emit]":"_emit","submit form[data-emit]":"_emit"},c.prototype.destroy=function(){return _.each(this.bindings,function(a){return a.destroy()})},c.prototype._outlet=function(a){return this.$("script[data-outlet]").each(function(b,c){var d,e;return(e=$(c).data("outlet"))?$(c).replaceWith(a[e].el):(d=_.map(a,function(a){return a.el}),$(c).replaceWith(d))})},c.prototype._applyBindings=function(a){var b=this;return this.$("[data-bind]").each(function(c,d){var e,f,g,h,i;for(h=$(d).data("bind").split(" "),i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(b.bindings.push(Traction.Bindings.Factory(d,e).bindTo(a)));return i})},c.prototype._emit=function(a){var b,c,d,e,f;for(c=a.currentTarget.getAttribute("data-emit").split(" "),f=[],d=0,e=c.length;e>d;d++)b=c[d],f.push(this.$el.trigger(b));return f},c}(Backbone.View)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rendering.AppendStrategy=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){return this.setElement(this.options.renderWithin)},c.prototype.render=function(){return this.$el.empty()},c.prototype.outlet=function(a){return this.$el.append(a.els())},c}(Backbone.View)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rendering.PrerenderedStrategy=function(a){function c(a){this.setElement(a.renderWithin),c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.call=function(a){return null==a&&(a={}),this._applyBindings(a.bindTo),this._outlet(a.children)},c}(Traction.Rendering.NodeStrategy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rendering.TemplateStrategy=function(a){function c(a){this.setElement(a.renderWithin),this.template=this.findTemplate(a.template),c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.findTemplate=function(a){var b;return b="templates",JST[""+b+"/"+a]||function(){throw"Missing template: "+a}()},c.prototype.call=function(a){return null==a&&(a={}),this.$el.empty(),this.el.innerHTML=this._template(),this._applyBindings(a.bindTo),this._outlet(a.children)},c.prototype.buildOutlet=function(a){return a||(a=""),"<script data-outlet='"+a+"'></script>"},c.prototype._template=function(a){return this.template(_.extend(a||{},this._defaultTemplateOptions()))},c.prototype._defaultTemplateOptions=function(){return{outlet:this.buildOutlet}},c}(Traction.Rendering.NodeStrategy)}.call(this),function(){Traction.Bindings.Binding=function(){function a(){}return a.prototype.bindTo=function(a){return this.model=a,this.model.on("change:"+this.property,this.update,this),this.update(),this},a.prototype.destroy=function(){return this.model.off(null,null,this)},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Bindings.ContentBinding=function(a){function c(a,b){this.el=a,this.specification=b,this.property=this.specification}return b(c,a),c.prototype.update=function(){return this.el.innerHTML=this.model.get(this.property)},c}(Traction.Bindings.Binding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=[].slice;Traction.Bindings.FormattedContentBinding=function(a){function d(a,b){var d,e=this;this.el=a,this.specification=b,d=this.specification.split("|"),this.property=d[0],this.formatters=2<=d.length?c.call(d,1):[],this.formattingFunctions=_.map(this.formatters,function(a){return e._buildFormattingFunction(a)})}return b(d,a),d.prototype.update=function(){return this.el.innerHTML=_.reduce(this.formattingFunctions,function(a,b){return b(a)},this.model.get(this.property))},d.prototype._buildFormattingFunction=function(a){var b,d,e;return e=a.split(":"),a=e[0],b=2<=e.length?c.call(e,1):[],d=Traction.TemplateHelpers.Formatting[a],function(a){return d.apply(a,b)}},d}(Traction.Bindings.Binding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Bindings.AttributeBinding=function(a){function c(a,b){var c;this.el=a,this.specification=b,c=this.specification.split(":"),this.attribute=c[0],this.property=c[1],this.trueValue=c[2],this.falseValue=c[3]}return b(c,a),c.prototype.update=function(){return this._hasBooleanSpecification()?this._booleanUpdate():this._directUpdate()},c.prototype._hasBooleanSpecification=function(){return null!=this.trueValue},c.prototype._booleanUpdate=function(){if(this._currentValue()){if(this._addValueToAttribute(this.trueValue),this.falseValue)return this._removeValueFromAttribute(this.falseValue)}else if(this._removeValueFromAttribute(this.trueValue),this.falseValue)return this._addValueToAttribute(this.falseValue)},c.prototype._directUpdate=function(){return this._removeValueFromAttribute(this.previousValue),this._addValueToAttribute(this._currentValue()),this.previousValue=this._currentValue()},c.prototype._addValueToAttribute=function(a){return this._setAttribute(_.union(this._existingValues(),[a]))},c.prototype._removeValueFromAttribute=function(a){return this._setAttribute(_.without(this._existingValues(),a))},c.prototype._existingValues=function(){return($(this.el).attr(this.attribute)||"").split(" ")},c.prototype._setAttribute=function(a){return $(this.el).attr(this.attribute,_.string.clean(a.join(" ")))},c.prototype._currentValue=function(){return this.model.get(this.property)},c}(Traction.Bindings.Binding)}.call(this),function(){Traction.Bindings.Factory=function(a,b){return b.indexOf(":")>0?new Traction.Bindings.AttributeBinding(a,b):b.indexOf("|")>0?new Traction.Bindings.FormattedContentBinding(a,b):new Traction.Bindings.ContentBinding(a,b)}}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rails.Model=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.associations={},c.prototype.initialize=function(){return this._isBaseClass()||this.paramRoot||(this.paramRoot=this._inferParamRoot()),this.on("error",this.parseErrors,this)},c.prototype.set=function(a,b,d){var e;return"object"==typeof a?(e=_.clone(a),d=b):(e={},e[a]=b),this._setAssociations(e,d||{}),c.__super__.set.call(this,e,d)},c.prototype.parseErrors=function(a,b){var c;return this.errors=null!=(c=$.parseJSON(b.responseText))?c.errors:void 0},c.prototype.toggle=function(a){return this.set(a,!this.get(a))},c.prototype.url=function(){return this.get("url")||c.__super__.url.apply(this,arguments)},c.prototype.toJSON=function(){var a,b,d,e,f;if(this.persists){for(b={},f=this.persists,d=0,e=f.length;e>d;d++)a=f[d],b[a]=this.get(a);return b}return c.__super__.toJSON.apply(this,arguments)},c.prototype._inferParamRoot=function(){return _.string.underscored(this._className())},c.prototype._className=function(){return this.constructor.toString().match(/function\s(.*?)\(/)[1].toString()},c.prototype._isBaseClass=function(){return this.constructor===Traction.Rails.Model},c.prototype._setAssociations=function(a,b){var c,d,e,f,g,h,i,j;i=this.associations,j=[];for(c in i){if(e=i[c],f=a[c],g=this.get(c)){if(!(c in a))continue;d=this._updateAssociation(e,c,f),d&&!b.silent&&this.trigger("change:"+c,g)}else this._createAssociation(e,c,f);delete a[c],(h=a[""+c+"_url"])?j.push(this.get(c).url=h):j.push(void 0)}return j},c.prototype._createAssociation=function(a,b,c){return c instanceof a?this.attributes[b]=c:(c=new a(c),this.attributes[b]=c)},c.prototype._updateAssociation=function(a,b,c){var d,e;return e=!1,c instanceof a||!c?(e=c!==this.get(b),this.attributes[b]=c):(d=function(){return e=!0},this.get(b).on("change add remove",d),this.get(b).set(c),this.get(b).off("change add remove",d)),e},c}(Backbone.Model)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Rails.Collection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Traction.Rails.Model,c.prototype.build=function(){var a;return a=new this.model,a.urlRoot=this.url,a},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Forms.Field=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.className="field",c.prototype.initialize=function(){return this.options=_.extend(this._defaults(),this.options),this.listenTo(this.model,"change:"+this.options.attribute,this.reset)},c.prototype.render=function(){return this._empty(),this._renderLabel(),this._renderInput(),this.options.required&&this._designateAsRequired(),this.reset(),this},c.prototype.renderErrors=function(a){return this.$el.addClass("error").append('<span class="inline-errors">'+a.join(", ")+"</span>")},c.prototype.disable=function(){return this._input().attr("disabled","disabled")},c.prototype.enable=function(){return this._input().removeAttr("disabled")},c.prototype.get=function(){return this._input().val()},c.prototype.set=function(a){return this._input().val(a)},c.prototype.clear=function(){return this._input().val(""),this.clearErrors()},c.prototype.clearErrors=function(){return this.$el.removeClass("error"),this.$(".inline-errors").remove()},c.prototype.rerenderErrors=function(a){return this.clearErrors(),this.renderErrors(a)},c.prototype.reset=function(){return this.set(this.model.get(this.options.attribute))},c.prototype.commit=function(){return this.model.set(this.options.attribute,this.get())},c.prototype.applyAutoCommit=function(){return this.options.autoCommit?this.commit():void 0},c.prototype._input=function(){return this.input||(this.input=this.$("input"))},c.prototype._empty=function(){return this.$el.empty(),this.input=null},c.prototype._renderLabel=function(){return this.$el.append(this.labelTemplate({options:this.options}))},c.prototype._renderInput=function(){return this.$el.append(this.inputTemplate({options:this.options}))},c.prototype._designateAsRequired=function(){return this.$el.addClass("required")},c.prototype._defaults=function(){return{id:this.cid,placeholder:this.options.label,autoCommit:!0,required:!1}},c}(Backbone.View)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Forms.TextField=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.labelTemplate=_.template('<label for="<%= options.id %>">\n  <% if(options.required) { %><i>*</i><% } %> <%= options.label %>\n</label>'),c.prototype.inputTemplate=_.template('<input id="<%= options.id %>" type="text" name="<%= options.name %>" placeholder="<%= options.placeholder %>"/>'),c.prototype.events={"change input":"applyAutoCommit"},c}(Traction.Forms.Field)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Forms.TextArea=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.labelTemplate=_.template('<label for="<%= options.id %>">\n  <% if(options.required) { %><i>*</i><% } %> <%= options.label %>\n</label>'),c.prototype.inputTemplate=_.template('<textarea id="<%= options.id %>" name="<%= options.name %>" placeholder="<%= options.placeholder %>"/>'),c.prototype.events={"change textarea":"applyAutoCommit"},c.prototype._input=function(){return this.input||(this.input=this.$("textarea"))},c}(Traction.Forms.Field)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Forms.Select=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.labelTemplate=_.template('<label for="<%= options.id %>">\n  <% if(options.required) { %><i>*</i><% } %> <%= options.label %>\n</label>'),c.prototype.inputTemplate=_.template('<select id="input-<%= options.id %>" name="<%= options.name %>">\n  <% if(options.includeBlank) { %><option><%= options.includeBlank %></option><% } %>\n  <% _.each(options.options, function(value, label){ %>\n    <option value="<%= value %>"><%= label %></option>\n  <% }) %>\n</select>'),c.prototype.events={"change select":"applyAutoCommit"},c.prototype.clear=function(){return this._input().val(this._firstOptionValue()),this.clearErrors()},c.prototype._firstOptionValue=function(){return this.$("option:first").attr("value")},c.prototype._input=function(){return this.input||(this.input=this.$("select"))},c.prototype._renderInput=function(){return this.$el.append(this.inputTemplate({options:this.options}))},c}(Traction.Forms.Field)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Traction.Forms.Form=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.addInput=function(a){var b,c;return a=_.extend(this._defaults(a),a),(c=a.name)&&delete a.name,(b=a.type)&&delete a.type,this.children.add(c,new b(a))},c.prototype.serialize=function(){var a;return a={},this.children.each(function(b){return a[b.attribute]=b.val()}),a},c.prototype.renderErrors=function(){var a,b,c,d,e;d=this.children,e=[];for(a in d)c=d[a],(b=this.model.errors[a])?e.push(c.rerenderErrors(b)):e.push(c.clearErrors());return e},c.prototype.clearErrors=function(){return this.children.each(function(a){return"function"==typeof a.clearErrors?a.clearErrors():void 0})},c.prototype.clear=function(){return this.children.each(function(a){return"function"==typeof a.clear?a.clear():void 0})},c.prototype.commit=function(){return this.children.each(function(a){return"function"==typeof a.commit?a.commit():void 0})},c.prototype.reset=function(){return this.children.each(function(a){return"function"==typeof a.reset?a.reset():void 0})},c.prototype._defaults=function(a){return{name:a.attribute,label:this._generateLabel(a.attribute),type:Traction.Forms.TextField,model:this.model}},c.prototype._generateLabel=function(a){return _.str.capitalize(_.str.humanize(a))},c}(Traction.View)}.call(this);